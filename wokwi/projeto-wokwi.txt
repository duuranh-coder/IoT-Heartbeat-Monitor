Projeto Wokwi – IoT Heartbeat Monitor (Scenario 2 – MQTT)

Este guia descreve como rodar o projeto “IoT Heartbeat Monitor – Scenario 2 (MQTT)” diretamente no simulador Wokwi, sem necessidade de hardware físico.

--------------------------------------------------------------
1. Arquivos da Simulação
--------------------------------------------------------------

Esta pasta contém os seguintes arquivos fornecidos pelo Wokwi:

- diagram.json
    Descreve todo o circuito eletrônico do projeto (ESP32, potenciômetro, LED e buzzer).

- libraries.txt
    Lista as bibliotecas que o ambiente de simulação carrega automaticamente.

- (Opcional) sketch.ino
    O código principal pode ser colado diretamente no editor do Wokwi.

Se o arquivo sketch.ino não estiver aqui, utilize o código localizado em:
    ../codigo-esp32/sketch.ino

--------------------------------------------------------------
2. Abrindo o Projeto no Wokwi
--------------------------------------------------------------

1. Acesse o site:
   https://wokwi.com/

2. Clique em “New Project”.

3. No menu inicial, escolha:
   → ESP32 (MicroPython ou Arduino – selecione a versão Arduino IDE)

4. Dentro do editor do Wokwi:
   - Exclua qualquer arquivo padrão criado automaticamente.
   - Importe os arquivos da pasta “wokwi”:
       - diagram.json
       - libraries.txt

5. No lado esquerdo, o circuito será montado automaticamente com:
   - ESP32 DevKit
   - Potenciômetro simulando o sinal de ECG
   - LED
   - Buzzer

--------------------------------------------------------------
3. Inserindo o Código no Editor do Wokwi
--------------------------------------------------------------

1. No Wokwi, abra o arquivo “sketch.ino” criado automaticamente.
2. Apague todo o conteúdo.
3. Cole o código contido em:
   codigo-esp32/sketch.ino

Esse é o código real do projeto, incluindo:
- Conexão Wi-Fi simulada do Wokwi
- Conexão ao broker MQTT (test.mosquitto.org)
- Publicação de valores do ECG
- Publicação de alertas
- Assinatura de comandos MQTT
- Controle automático e manual de LED e buzzer

--------------------------------------------------------------
4. Executando a Simulação
--------------------------------------------------------------

1. Clique no botão verde “Play”.

2. O Wokwi abrirá automaticamente:
   - Uma janela com o circuito
   - O monitor serial

3. No Serial Monitor, você deve ver:
   - Conexão à rede Wokwi-GUEST (simulada)
   - Conexão bem-sucedida ao broker MQTT
   - Publicação de valores de ECG
   - Mensagens indicando estado do LED e buzzer
   - Publicação de alertas quando necessário

4. Gire o potenciômetro:
   - Isso altera o valor lido pelo ADC no pino 34 (ECG_PIN).
   - Valores fora da faixa [500, 2000] provocam:
       - LED aceso imediatamente (modo automático)
       - Buzzer acionado após alguns segundos
       - Publicação de alerta via MQTT

--------------------------------------------------------------
5. Testando com MQTT Durante a Simulação
--------------------------------------------------------------

Mesmo no Wokwi, o ESP32 está usando um Wi-Fi virtual e se conecta ao broker real.

1. Abra um cliente MQTT externo (sugerido: MQTTX).

2. Conecte ao broker:
   Host: test.mosquitto.org
   Porta: 1883

3. Assine os tópicos:
   iot/monitor/ecg
   iot/monitor/alert

4. Envie comandos no tópico:
   iot/monitor/cmd

Comandos disponíveis:

- RESET
- LED_ON
- LED_OFF
- LED_AUTO
- BUZZER_ON
- BUZZER_OFF
- BUZZER_AUTO

5. Observe o Wokwi reagindo aos comandos:
   - LED liga/desliga na simulação.
   - Buzzer ativa/desativa.
   - RESET limpa o estado interno e retorna ao modo automático.

--------------------------------------------------------------
6. Observações Importantes
--------------------------------------------------------------

- O Wokwi se conecta automaticamente ao SSID "Wokwi-GUEST".
- Você NÃO precisa inserir senha — a simulação ignora a senha real do Wi-Fi.
- O comportamento de rede é simulado, mas a conexão MQTT é real.
- Não teste com TLS no Wokwi — o suporte é limitado.
- O fluxograma real de comunicação MQTT está documentado em:
    docs/comunicacao_mqtt.md

--------------------------------------------------------------
7. Fim do Guia
--------------------------------------------------------------
